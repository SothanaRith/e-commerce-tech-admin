<script setup>
import InvoiceAddPaymentDrawer from '@/views/apps/invoice/InvoiceAddPaymentDrawer.vue'
import InvoiceEditable from '@/views/apps/invoice/InvoiceEditable.vue'
import InvoiceSendInvoiceDrawer from '@/views/apps/invoice/InvoiceSendInvoiceDrawer.vue'

const invoiceData = ref()
const route = useRoute('apps-invoice-edit-id')
const { data: invoiceDetails } = await useApi(`/apps/invoice/${ route.params.id }`)
if (invoiceDetails.value) {
  invoiceData.value = {
    invoice: invoiceDetails.value.invoice,
    paymentDetails: invoiceDetails.value.paymentDetails,
    purchasedProducts: [{
      title: 'App Design',
      cost: 24,
      hours: 2,
      description: 'Designed UI kit & app pages.',
    }],
    note: 'It was a pleasure working with you and your team. We hope you will keep us in mind for future freelance projects. Thank You!',
    paymentMethod: 'Bank Account',
    salesperson: 'Tom Cook',
    thanksNote: 'Thanks for your business',
  }
}

const addProduct = value => {
  invoiceData.value?.purchasedProducts.push(value)
}

const removeProduct = id => {
  invoiceData.value?.purchasedProducts.splice(id, 1)
}

const isSendSidebarActive = ref(false)
const isAddPaymentSidebarActive = ref(false)
const paymentTerms = ref(true)
const clientNotes = ref(false)
const paymentStub = ref(false)
const selectedPaymentMethod = ref('Bank Account')

const paymentMethods = [
  'Bank Account',
  'PayPal',
  'UPI Transfer',
]
</script>

<template>
  <VRow v-if="invoiceData && invoiceData?.invoice">
    <!-- ðŸ‘‰ InvoiceEditable -->
    <VCol
      cols="12"
      md="9"
    >
      <InvoiceEditable
        v-if="invoiceData?.invoice"
        :data="invoiceData"
        @push="addProduct"
        @remove="removeProduct"
      />
    </VCol>

    <!-- ðŸ‘‰ Right Column: Invoice Action -->
    <VCol
      cols="12"
      md="3"
    >
      <VCard class="mb-8">
        <VCardText>
          <div class="d-flex flex-wrap gap-4">
            <!-- ðŸ‘‰  Preview button -->
            <VBtn
              color="secondary"
              variant="tonal"
              class="flex-grow-1"
              :to="{ name: 'apps-invoice-preview-id', params: { id: route.params.id } }"
            >
              Preview
            </VBtn>

            <!-- ðŸ‘‰ Save button -->
            <VBtn
              color="secondary"
              variant="tonal"
              class="mb-4 flex-grow-1"
            >
              print
            </VBtn>
          </div>

        </VCardText>
      </VCard>
    </VCol>

    <!-- ðŸ‘‰ Invoice send drawer -->
    <InvoiceSendInvoiceDrawer v-model:is-drawer-open="isSendSidebarActive" />

    <!-- ðŸ‘‰ Invoice add payment drawer -->
    <InvoiceAddPaymentDrawer v-model:is-drawer-open="isAddPaymentSidebarActive" />
  </VRow>

  <section v-else>
    <VAlert
      type="error"
      variant="tonal"
    >
      Invoice with ID  {{ route.params.id }} not found!
    </VAlert>
  </section>
</template>
